<%= stylesheet_link_tag "items" %>
<%= javascript_include_tag "items" %>

<h1>Edit Listing</h1>

<%= form_for @item, html: {multipart: true}  do |f| %>

<div class="item-container">
	<div class="form-content">
		<div class="new-item-form">
			<% if @item.listing_type == 'timeoffer' %>
				<p> First, add some tags to better describe your service, so it shows up quicker when searched:</p>
			<% else %>
				<p> First, add some tags to your listing, so it shows up quicker when searched:</p>
			<% end %>
	          <div class="tag-input-box">
	            <input type="text" name="tag_box_1" id="tag-box-1" class="tag-box" placeholder="type here, ex. xbox">
	            <input type="text" name="tag_box_2" id="tag-box-2" class="tag-box">
	            <input type="text" name="tag_box_3" id="tag-box-3" class="tag-box">
	            <input type="text" name="tag_box_4" id="tag-box-4" class="tag-box">
	          </div>
	        	<input type="button" value="Add More" id="add-tag-button-edit"/>
	        <div id="tag-instruction">* Maximum of 6 tags, empty boxes will not be added.</div>
		</div>

		<div class="new-item-form">
			<p> Add a Location:</p>
			<p class="form-title">Postal Code</p>
			<%= f.text_field :postal_code, :maxlength=> "6", :placeholder => "ex. M5V3A6, This way people nearby are more likely to discover your listing" %>
		</div>

		<% if @item.listing_type == 'rent'%>
			<%= f.hidden_field :listing_type, :value =>"rent" %>
		<% elsif @item.listing_type == 'sell' %>
			<%= f.hidden_field :listing_type, :value =>"sell" %>
		<% elsif @item.listing_type == 'lease' %>
			<%= f.hidden_field :listing_type, :value =>"lease" %>
		<% else %>
			<%= f.hidden_field :listing_type, :value =>"timeoffer" %>
		<% end %>

		<div class="new-item-form">
			<p> Description:</p>
			<p class="form-title">Listing Title</p>
			<%= f.text_field :title, :maxlength=> "100", :placeholder => "Give your listing a concise and catchy headline!"  %>
		</div>

		<div class="new-item-form">
			<%= f.label :summary %>
			<%= f.text_area :description, :maxlength=> "500", :placeholder => "Tell people about the qualities and highlights of your listing. You can include as many details as you'd like." %>
			<div class="countdown"></div>
		</div>

		<div class="new-item-form">
			<%#= f.file_field :photo %>
      <%= file_field_tag "images[]", type: :file, multiple: true %>
			<div class="upload-photo">
				<%= image_tag "phone.png", id:"photo-image" %>
				<p id="pic-title">  + Add Photo </p>
				<p id="descriptor"> You can upload more than one file at a time </p>
			</div>
		</div>

		<% if @item.listing_type == 'timeoffer' %>
			<%= f.fields_for :prices, @price do |p| %>
			    <%= p.hidden_field :timeframe, :value => "Hour" %>
			    <div class="new-item-form">
			    	<p> Your Price:</p>
						<div class="rent-deposit-money-sign"> $ </div>
			        <%=p.number_field :amount %> <span class="perhr">per Hour</span>
			    </div>
			    <%= f.hidden_field :deposit, :value => 0 %>
			<% end %>
		<% elsif @item.listing_type == 'sell' %>
			<%= f.fields_for :prices, @price do |p| %>
				<div class="new-item-form">
			    	<p> Sale Price:</p>
						<div id="actual-price-money-sign"> $ </div>
			        <%=p.number_field :amount %>
			    </div>
			    <%= f.hidden_field :deposit, :value => 0 %>
			<% end %>
		<% else %>
			<%= f.fields_for :prices, Price.new do |day| %>
        <%= f.fields_for :prices, Price.new do |week| %>
          <%= f.fields_for :prices, Price.new do |month| %>
    			  <div class="new-item-form">
      				<p class="deposit-tip">
      				  <b>Rental Price:</b></br>
      				  Set how much you want to charge for any or all of the timeframes</br>
      				  in the boxes below,leave the box blank if the timeframe is not</br>
      				  applicable.</br>
      				  Example: $10 per day, $60 per week and/or $200 per month.
      				</p>
      				<table>
      				  <tr>
      				  	<th>Timeframe:</th>
      			      	<td><%= day.text_field :timeframe, :value => "Day", :readonly => "True", class: "timeframe" %></td>
      			      	<td><%= week.text_field :timeframe, :value => "Week", :readonly => "True", class: "timeframe" %></td>
      			      	<td><%= month.text_field :timeframe, :value => "Month", :readonly => "True", class: "timeframe" %></td>
      				  </tr>
    			      <tr>
    			      	<th>Price:</th>
    			      	<td><input class="money", readonly="true", value="$"></input><%=day.number_field :amount, max: 100%></td>
    			      	<td><input class="money", readonly="true", value="$"></input><%=week.number_field :amount, max: 1000%></td>
    			        <td><input class="money", readonly="true", value="$"></input><%=month.number_field :amount, max: 10000%></td>
    			      </tr>
      				</table>
      				<br/>
    			  </div>

      			<div class="new-item-form">
  	          <% if @item.listing_type == 'lease' %>
        				<p id="deposit-title"> Deposit Price & Sale Price:</p>
        				<div class="rent-deposit-money-sign"> $ </div>
      				  <%= f.text_field :deposit %>
  	          	<div class="deposit-tip">
  		          	This ensures that the item is treated with care, and is returned on time. </br>
  		          	This amount will be charged only if the other party fails to return the item, damage it, or lose it.</br></br>
  		          	After the rental period, your customer may request to buy this item.</br>
  		          	The Deposit Price will double as the Sale Price.</br>
  		          	Their rental fees will be
  		            credited towards the purchase.
  	            </div>
      	      <% else %>
  	          	<p id="deposit-title"> Deposit Price</p>
  	          	<div class="rent-deposit-money-sign"> $ </div>
  	          	<%= f.text_field :deposit %>
  	          	<div class="deposit-tip">
  	          		This ensures that the item is treated with care, and is returned on time.</br>
  	          		This amount will be charged only if the other party fails to return the item, damage it, or lose it.
  	          	</div>
      	      <% end %>
    	      </div>

          <% end %>
        <% end %>
			<% end %>
		<% end %>


		<%= f.submit 'Submit', :class => 'submit-listing', :onclick => 'validate_user_form_and_submit()' %>
		<div id="small-tip"> you can edit/update your listing at anytime after you submit.</div>


<%end%>
	</div>
</div>

<script>
	<% counter = 1 %>
	<% @tags.each do |tag| %>
		<% if counter < 5 %>
			$("#tag-box-<%= counter %>").val("<%= tag %>");
		<% else %>
			var newHtml = '<input type="text" name="tag_box_' + "<%= counter %>" +'" id="tag-box-' + "<%= counter %>" +'" class="tag-box" >';

			$(".tag-input-box").append(newHtml);
			$('#tag-box-<%= counter %>').val("<%= tag %>")
		<% end %>

		<% counter = counter + 1 %>
	<% end %>

	<% @prices.each do |price| %>
		<% if price.timeframe == 'Day' %>
			$('#item_prices_attributes_0_amount').val("<%= price.amount.to_digits %>");
		<% elsif price.timeframe == 'Week' %>
			$('#item_prices_attributes_1_amount').val("<%= price.amount.to_digits %>");
		<% elsif price.timeframe == 'Month' %>
			$('#item_prices_attributes_2_amount').val("<%= price.amount.to_digits %>");
		<% end %>
	<% end %>

	// Make sure the add answer button is showing
	$("#add-tag-button").css("display", "inline-block");

	var tagBoxCounter = <%= @tags.length %>;
	var MAX_BOX_COUNT = 6;

	$("#add-tag-button-edit").click(function() {
	  // add another tag text box when clicked under existing text box.
	  var newBoxNumber = tagBoxCounter + 1;

	  if (newBoxNumber <= MAX_BOX_COUNT) {
	    var newHtml = '<input type="text" name="tag_box_' + newBoxNumber +'" id="tag-box-' + newBoxNumber +'" class="tag-box" >';

	    $(".tag-input-box").append(newHtml);
	    tagBoxCounter++;
	  } else {
	    $("#add-tag-button").css("display", "none");
	  }
	});
</script>
